var create_sortable_list=function(a){return ordered_list={initialised:!1,init:function(a){return this.initialised||(this.update_url=a.update_url,this.sortable_list=a.sortable_list,this.tree=a.tree,this.div_with_list_and_actions=this.sortable_list.parents().filter(function(a){return $(this).children("#actions").length>0}),this.actions=$("#actions",this.div_with_list_and_actions),this.reorder_action=$("#reorder_action",this.actions),this.reorder_action_done=$("#reorder_action_done",this.actions),this.sortable_list.addClass("sortable_list"),this.reorder_action.click($.proxy(this.enable_reordering,{list:this})),this.reorder_action_done.click($.proxy(this.disable_reordering,{list:this})),this.tree==0&&this.sortable_list.find("li").addClass("no-nest"),this.sortable_list.nestedSortable({listType:"ul",disableNesting:"no-nest",forcePlaceholderSize:!0,handle:this.tree?"div":null,items:"li",opacity:.6,placeholder:"placeholder",tabSize:25,tolerance:"pointer",toleranceElement:this.tree?"> div":null,disabled:!0,start:function(){},change:$.proxy(this.change,{list:this}),stop:$.proxy(this.stop,{list:this})}),this.tree?this.reset_branch_classes(this.sortable_list):this.reset_on_off_classes(this.sortable_list),this.initialised=!0),this},stop:function(){this.list.tree?(this.list.reset_branch_classes(this.list.sortable_list),this.list.reset_icon_classes(this.list.sortable_list)):this.list.reset_on_off_classes(this.list.sortable_list)},change:function(){this.list.tree&&this.list.reset_branch_classes(this.list.sortable_list)},reset_on_off_classes:function(a){$("> li",a).each(function(a,b){$(b).removeClass("on off on-hover").addClass(a%2===0?"on":"off")})},reset_branch_classes:function(a){$("li.ui-sortable-helper",this).removeClass("record").removeClass("branch_start").removeClass("branch_end"),$("li",a).removeClass("branch_start").removeClass("branch_end"),$("> li:first",a).addClass("branch_start"),$("> li:last",a).addClass("branch_end");var b=$("ul",a);$("> li:last",b).addClass("branch_end")},reset_icon_classes:function(a){$("li",a).each(function(){var a=$(this),b=a.find(".icon:first");a.find("ul li").size()>0?b.addClass("toggle expanded"):b.hasClass("expanded")&&b.removeClass("toggle expanded")})},enable_reordering:function(a){a&&a.preventDefault(),this.list.sortable_list.addClass("reordering"),$(".actions",this.list.sortable_list).fadeTo(500,.3),this.list.div_with_list_and_actions.parents().siblings("div").fadeTo(500,.3),$('*:not("#reorder_action_done, #reorder_action")',this.list.actions).not(this.list.reorder_action_done.parents("li, ul, div")).fadeTo(500,.55),this.list.sortable_list.nestedSortable("enable"),this.list.reorder_action.hide(),this.list.reorder_action_done.show()},disable_reordering:function(a){a&&a.preventDefault();if(this.list.reorder_action_done.hasClass("loading"))return!1;this.list.reorder_action_done.addClass("loading"),this.list.sortable_list.nestedSortable("disable"),this.list.sortable_list.removeClass("reordering");if(this.list.update_url!==null){var b=this.list.sortable_list.serializelist();$.post(this.list.update_url,b,$.proxy(this.list.restore_controls,{list:this.list}))}else $.proxy(this.list.restore_controls,{list:this.list})()},restore_controls:function(a){this.list.sortable_list.removeClass("reordering"),$(".actions",this.list.sortable_list).fadeTo(250,1),this.list.div_with_list_and_actions.parents().siblings("div").fadeTo(250,1),$('*:not("#reorder_action_done, #reorder_action")',this.list.actions).not($("#reorder_action_done").parents("li, ul, div")).fadeTo(250,1),this.list.reorder_action_done.hide().removeClass("loading"),this.list.reorder_action.show()}},ordered_list.init(a),ordered_list};